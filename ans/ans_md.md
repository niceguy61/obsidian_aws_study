# ANS Study

## 1. Amazon VPC Fundamentals

### What is VPC?

- Amazon VPC는 AWS 클라우드에서 사용자가 정의한 가상 네트워크 환경으로, 온프레미스 네트워크와 유사한 구조를 제공합니다.

- AWS 클라우드의 리소스를 가상 네트워크에 배치하고, 네트워크 설정을 세부적으로 제어할 수 있습니다.

![[vpc_mean.png]]

- 서비스의 특징
	1. 가상 네트워크 구성:
		- CIDR(Classless Inter-Domain Routing)을 사용하여 IP 주소 범위를 정의.
		- 퍼블릭 및 프라이빗 서브넷을 사용하여 네트워크를 세분화.
	2. 유연한 연결 옵션:
		- 인터넷 게이트웨이, NAT 게이트웨이, VPN, Direct Connect를 통해 외부와 통신 가능.
	3. 보안 및 제어:
		- 보안 그룹과 네트워크 ACL을 통해 세부적인 보안 규칙 설정.
		- 로컬 트래픽과 외부 트래픽에 대해 라우팅 제어.

- VPC 활용 사례
	- 온프레미스 네트워크와 연결하여 하이브리드 클라우드 환경 구성.
	- AWS 리소스 간 안전한 네트워크 통신.
	- 외부 인터넷 액세스가 필요 없는 내부 애플리케이션 배치.

- 특장점:
	- 네트워크 설정의 유연성 제공.
	- 온프레미스 네트워크와 원활하게 통합 가능.
	- AWS의 확장성을 활용하면서 보안 제어 가능.

- 유의사항:
	- 네트워크 설계가 복잡할 수 있음.
	- 잘못된 설정은 보안 문제를 유발할 수 있음.
 

### Scope of VPC with respect to AWS Account, Region & AZ

- AWS 서비스 범위
	- 글로벌 서비스: AWS 계정, IAM, Route 53과 같은 서비스는 글로벌로 작동하며, 리전 제한이 없습니다.
	- 리전 기반 서비스: EC2, RDS, VPC 등은 특정 리전 내에서만 작동하며, 데이터는 리전 간 자동 복제되지 않음(사용자 설정 필요).
	- 가용 영역(AZ): 리전 내 독립적으로 운영되는 데이터 센터. 장애 격리와 고가용성을 위해 여러 AZ 사용 권장.
	- VPC: 특정 리전 내에서 작동하며, 서브넷 및 라우트 테이블로 네트워크 트래픽 관리.

![[vpc_with_account_region_az.png]]

- 서비스 범위별 주요 사항
	- 글로벌 서비스:
		- IAM: 사용자 및 권한 관리.
		- Route 53: 글로벌 DNS 관리.
		- CloudFront: 글로벌 콘텐츠 배포.
	- 리전 기반 서비스:
		- EC2, RDS 등은 리전 내에서만 리소스를 실행.
		- 리전 간 연결 시 추가 설정 필요.
	- AZ 기반 리소스:
		- 서브넷과 EC2 인스턴스는 특정 AZ에 위치.
		- 고가용성을 위해 다중 AZ 배포 권장.
	- VPC:
		- 리전 내의 논리적 네트워크 격리.
		- 서브넷을 통해 AZ 단위로 네트워크 세분화.

- AWS 관련 서비스
	- 글로벌 서비스: IAM, Route 53, CloudFront.
	- 리전 서비스: EC2, RDS, VPC.
	- AZ 기반 서비스: 서브넷, EC2 인스턴스.

- Pros:
	- 서비스가 글로벌, 리전, AZ로 나뉘어 있어 설계가 유연함.
	- AZ를 활용한 고가용성 및 장애 격리 가능.

- Cons:
	- 리전 간 데이터 전송 시 추가 비용 발생.
	- 복잡한 리전 간 서비스 통합이 필요할 수 있음.
 

### VPC Building Blocks - Core Components

![[vpc_building_block.png]]

- CIDR (Classless Inter-Domain Routing)
	- VPC의 IP 주소 범위를 정의합니다. IPv4는 /16에서 /28 범위, IPv6는 /56 범위를 사용합니다.
	- AWS 권장 프라이빗 IP 범위:
		- 10.0.0.0/8
		- 172.16.0.0/12
		- 192.168.0.0/16

- Subnets
	- VPC를 더 작은 서브넷으로 나누어 각 가용 영역(AZ)에 배치됩니다.
	- 서브넷은 퍼블릭과 프라이빗으로 나뉘며, 퍼블릭은 인터넷 게이트웨이를 통해 인터넷과 연결됩니다.

- Route Tables
	- 서브넷의 트래픽 라우팅을 정의합니다.
	- VPC는 기본 라우팅 테이블(Main Route Table)을 갖추고 있으며, 사용자 정의 라우팅 테이블을 추가할 수 있습니다.

- Internet Gateway (IGW)
	- VPC와 인터넷 간의 통신을 지원하는 가상 게이트웨이입니다.

- Security Groups
	- EC2 인스턴스와 같은 자원에 대한 네트워크 트래픽을 제어합니다.
	- 상태 저장 방식을 사용하며, 인바운드와 아웃바운드 규칙을 설정할 수 있습니다.

- Network Access Control List (NACL)
	- 서브넷 수준에서 적용되며 트래픽을 허용하거나 차단하는 규칙을 설정합니다.
	- 상태 비저장 방식을 사용하며, 명시적으로 아웃바운드 트래픽을 열어야 합니다.

- Domain Name Server (DNS)
	- VPC의 DNS 해석을 제공합니다.
	- 기본적으로 AWS 제공 DNS 서버(Route 53 Resolver)를 사용합니다.

### VPC Addressing (CIDR)

![[vpc_cidr_mean.png]]

![[vpc_cidr_mean_2.png]]
- CIDR (Classless Inter-Domain Routing):
	- IP 주소를 할당하는 체계로, 기존의 A/B/C 클래스 방식의 단점을 보완.
	- IPv4 주소는 네트워크 주소와 호스트 주소로 구분되며, 예시: 192.168.0.0/24는 256개의 IP를 포함.
	- IPv6 주소는 글로벌 고유 주소를 제공하며, AWS에서는 /56 또는 /64 블록 크기를 사용.

- IPv4 VPC CIDR:
	- VPC 내 IP 주소 범위는 /16에서 /28까지 지원.
	- AWS 권장 프라이빗 IP 범위:
	- 10.0.0.0/8 (16,777,216개 주소)
	- 172.16.0.0/12 (1,048,576개 주소)
	- 192.168.0.0/16 (65,536개 주소)

- IPv6 VPC CIDR:
	- IPv6 주소는 AWS에서 자동 할당되며, 서브넷 크기는 /64.
	- 글로벌 고유 주소로 인터넷 연결 가능.
	- IPv6는 AWS에서 기본적으로 퍼블릭 주소로 처리됨.

- 서브넷 주소 할당:
	- VPC CIDR에서 서브넷 CIDR은 /16에서 /28 범위로 정의.
	- 각 서브넷은 AWS가 5개의 IP를 예약:
	- 네트워크 주소, 라우터, DNS 매핑, AWS 예약, 브로드캐스트 주소.

- VPC CIDR의 유연성:
	- 멀티 VPC 환경에서 중복된 CIDR을 피하기 위해 신중한 설계 필요.
	- CIDR 크기는 필요한 호스트 수에 맞게 설정하되, AWS 예약 IP를 고려.

- 주요 포인트:
	- 시험에서 CIDR 블록의 크기 및 IP 예약 규칙과 관련된 문제가 자주 등장.

| Feature		| IPv4						  | IPv6							|
| -------------- | ----------------------------- | ------------------------------- |
| Address Size   | 32-bit (4 옥텟)				 | 128-bit (8 블록)				  |
| Address Format | 점으로 구분된 10진수 (예: 192.168.1.1) | 콜론으로 구분된 16진수 (예: 2001:0db8::1) |
| Address Space  | 약 43억 개의 주소				   | 거의 무한대 (2^128 주소)			   |
| Deployment	 | 현재 가장 널리 사용됨				  | 주로 신규 네트워크 및 확장용				|
| Public/Private | 공용/비공용 구분					 | 공용만 사용 (비공용 개념 없음)			  |
| Subnet Size	| 가변적, /8 ~ /32 사용 가능		   | 고정된 서브넷 크기 (/64)				|
| Security	   | 옵션으로 IPsec 지원				 | 기본적으로 IPsec 포함				  |
| NAT 필요 여부	  | 공용 IP 부족 문제로 NAT 필요		   | 넉넉한 주소 공간으로 NAT 불필요			 |
| DNS Support	| Amazon DNS를 통해 기본적으로 지원	   | Amazon DNS로 지원, 복잡성 증가		  |
| Header Size	| 20 bytes					  | 40 bytes						|
| Compatibility  | 기존 인터넷 프로토콜과 완전 호환			| IPv4와 직접 호환되지 않음				|

### VPC Route Tables

![[vpc_route_table.png]]

- 라우트 테이블이란?
	- VPC의 서브넷이나 게이트웨이를 통해 트래픽을 라우팅하는 데 사용됩니다.
	- 라우트 테이블은 여러 서브넷과 연결될 수 있습니다.

- 기본 특징
	- VPC 생성 시 기본(Main) 라우트 테이블이 자동으로 생성됩니다.
	- 모든 서브넷은 기본적으로 메인 라우트 테이블과 연결됩니다.
	- 각 라우트 테이블은 로컬 트래픽에 대한 기본 라우트(immutable local route)를 포함합니다.

- 커스텀 라우트 테이블
	- 서브넷별 커스텀 라우트 테이블을 생성해 특정 트래픽 흐름을 설정할 수 있습니다.
	- 예: 인터넷 게이트웨이를 추가하여 인터넷에 액세스 가능하도록 설정.

- 라우트 테이블 항목
	- 대상(Destination): 트래픽이 이동할 IP 범위 (예: 0.0.0.0/0).
	- 대상(Target): 트래픽이 이동할 게이트웨이, NAT, 네트워크 인터페이스 등.

- 예시
	- 인터넷 트래픽용 라우트:
		- 대상: 0.0.0.0/0, 타겟: 인터넷 게이트웨이(IGW).
	- 온프레미스 연결:
		- 대상: 특정 IP CIDR, 타겟: 가상 프라이빗 게이트웨이(VGW).

- 장점
	- 서브넷 수준에서 세밀한 트래픽 라우팅을 지원.
	- 다양한 AWS 게이트웨이(NAT Gateway, IGW, VGW)와 통합.

- 단점
	- 잘못된 라우트 설정 시 연결 오류 발생 가능.
	- 복잡한 네트워크 설계에서는 라우트 관리가 어려울 수 있음.

#### Caution
- AWS는 각 서브넷에서 5개의 IP 주소(처음 4개와 마지막 1개)를 예약하며, 이는 인스턴스에 할당할 수 없습니다. 예를 들어, CIDR 블록이 10.0.0.0/24인 경우 다음 IP가 예약됩니다:
- 10.0.0.0: 네트워크 주소.
- 10.0.0.1: VPC 라우터에 의해 예약.
- 10.0.0.2: Amazon 제공 DNS와 매핑을 위해 예약.
- 10.0.0.3: 미래 사용을 위해 AWS에서 예약.
- 10.0.0.255: 네트워크 브로드캐스트 주소(브로드캐스트는 VPC에서 지원되지 않음).
- 시험 팁:
	- EC2 인스턴스에 필요한 IP 주소가 29개인 경우, 서브넷 크기로 /27(32개의 IP)을 선택하면 사용할 수 있는 IP가 27개밖에 되지 않아 적합하지 않습니다. 대신, /26(64개의 IP)을 선택해야 합니다.

### IP Addresses - Private vs Public vs Elastic & Allocation

![[vpc_ip_address_public.png]]

- Private IP
	- 정의: VPC의 내부 네트워크 통신용 IP 주소. 인터넷에서는 사용되지 않음.
	- 할당: EC2 인스턴스 생성 시 자동으로 할당.
	- 사용 사례: 애플리케이션 서버, 데이터베이스 서버와 같은 내부 통신 필요 리소스.

- Public IP
	- 정의: 인터넷 통신이 가능한 IP 주소. AWS IP 풀에서 할당.
	- 할당 조건: 퍼블릭 서브넷에 생성된 EC2 인스턴스가 퍼블릭 IP를 받을 수 있도록 설정.
	- 특징:
		- 인스턴스가 정지되거나 종료되면 IP가 해제.
		- 사용 사례: 웹 서버, 인터넷과 직접 통신이 필요한 리소스.

- Elastic IP (EIP)
	- 정의: 고정된 공용 IP 주소. 인스턴스에 할당하여 정적 IP로 유지.
	- 할당 및 특징:
		- 명시적으로 요청하여 AWS 계정에 할당.
		- 인스턴스가 종료되거나 정지되더라도 해제되지 않음.
		- 각 계정에 기본적으로 5개의 EIP 할당 제한.

	- 사용 사례: DNS 레코드가 변경되지 않도록 고정 IP 유지가 필요한 경우.

- 주소 재할당
	- Elastic IP는 다른 인스턴스에 재할당 가능.
	- Public IP는 인스턴스 재시작 시 새로운 주소로 변경.

- 장점
	- Private IP는 비용 효율적이며 내부 네트워크 보안을 유지.
	- Elastic IP는 고정 IP 제공으로 네트워크 설계 유연성 증가.

- 단점
	- Public IP는 정지/종료 시 변경되어 고정 IP 필요 시 Elastic IP를 사용해야 함.
	- Elastic IP는 사용하지 않을 경우에도 비용 발생.

| Feature              | Private IP               | Public IP                | Elastic IP               |
| -------------------- | ------------------------ | ------------------------ | ------------------------ |
| **Definition**       | VPC 내부 통신용 비공개 IP 주소     | 인터넷에서 직접 통신 가능한 공용 IP 주소 | 고정 공용 IP 주소, AWS 계정에 할당  |
| **Allocation**       | VPC 서브넷 CIDR 범위에서 자동 할당  | 퍼블릭 서브넷에서 자동 할당 가능       | 명시적으로 요청 후 AWS 계정에 할당    |
| **Address Range**    | RFC 1918 개인 네트워크 범위 내 주소 | AWS가 제공하는 공용 IP 풀        | AWS가 제공하는 공용 IP 풀        |
| **Persistence**      | 인스턴스 정지 시 해제되지 않음        | 인스턴스 정지/종료 시 새 주소로 변경    | 인스턴스 정지/종료에도 유지          |
| **Cost**             | 무료                       | 과금 (since 2024.2.14 ~ )  | 사용하지 않을 경우 요금 발생         |
| **Use Case**         | 내부 애플리케이션, 데이터베이스 서버     | 웹 서버, 인터넷과 통신하는 리소스      | DNS 고정 및 고정된 IP가 필요한 서비스 |
| **IP Changeability** | 변경되지 않음                  | 인스턴스 재시작 시 변경 가능         | 고정, 다른 인스턴스에 재할당 가능      |
| **Internet Access**  | NAT 또는 게이트웨이 필요          | 가능                       | 가능                       |

### VPC Firewall: Security Group

![[vpc_security_group.png]]
![[vpc_security_group_2.png]]
- Security Group이란?
	- EC2 인스턴스 및 리소스에 적용되는 가상 방화벽.
	- 인바운드(수신) 및 아웃바운드(송신) 트래픽 제어.
	- VPC 내의 인스턴스 수준에서 작동.

- 주요 특징
	- 상태 유지(Stateful):
		- 허용된 인바운드 트래픽은 자동으로 해당 연결의 아웃바운드 트래픽 허용.
		- 아웃바운드 트래픽도 동일하게 동작.

	- 기본 동작:
		- 모든 인바운드 트래픽은 차단.
		- 모든 아웃바운드 트래픽은 허용.
		- 허용 규칙만 적용 가능: 차단(Deny) 규칙은 지원하지 않음.

- 구성 요소
	- 프로토콜: TCP, UDP, ICMP 등.
	- 포트 범위: 특정 포트 또는 범위 설정.
	- 소스/대상: CIDR, IP 주소, 또는 다른 Security Group.

- 예시
	- SSH 허용:
		- 프로토콜: TCP, 포트: 22, 소스: 203.0.113.0/24.
	- HTTP 트래픽 허용:
		- 프로토콜: TCP, 포트: 80, 소스: 0.0.0.0/0.

- 참조 가능
	- 다른 Security Group을 소스로 참조 가능하여 유연한 네트워크 정책 생성.

- 장점
	- 인스턴스 단위에서 세밀한 트래픽 제어 가능.
	- 동적 소스 참조를 통해 네트워크 구성 간소화.

- 단점
	- 블랙리스트(Deny) 정책 설정 불가능.
	- 서브넷 전체가 아닌 개별 리소스에만 적용.

### VPC Firewall: Network Access Control List (NACL)

![[vpc_nacl.png]]

- NACL이란?
	- VPC의 서브넷 수준에서 트래픽을 제어하는 방화벽.
	- 서브넷에 적용되며, 서브넷에 연결된 모든 인스턴스에 영향을 미침.
	- 보안 그룹과는 달리 Stateless(상태 비저장) 동작.

- 주요 특징
	- 규칙 기반 접근 제어:
		- 허용(Allow)과 거부(Deny) 규칙 모두 지원.
		- 우선 순위 기반 규칙:
		- 규칙 번호가 낮을수록 우선 순위가 높음.
		- 규칙이 일치하면 해당 트래픽에 대해 허용 또는 거부 처리.

	- 기본 NACL 동작:
		- 새로 생성된 NACL은 모든 트래픽을 허용.
		- 기본 규칙은 삭제 가능.

- 구성 요소
	- 규칙 번호: 각 규칙에 대한 우선 순위.
	- 타입: 트래픽 유형 (예: HTTP, HTTPS, SSH).
	- 프로토콜: TCP, UDP, ICMP 등.
	- 소스/대상: 특정 IP 주소, CIDR 블록.
	- 작업: 허용(Allow) 또는 거부(Deny).

- 예시
	- SSH 액세스 차단:
		- 규칙 번호: 100, 프로토콜: TCP, 포트: 22, 소스: 0.0.0.0/0, 작업: Deny.
	- HTTPS 허용:
		- 규칙 번호: 101, 프로토콜: TCP, 포트: 443, 소스: 0.0.0.0/0, 작업: Allow.

- 장점
	- 서브넷 수준에서 전체 트래픽 차단 가능.
	- 특정 IP 주소나 범위를 기반으로 트래픽 제어.

- 단점
	- Stateless 동작으로 인해 인바운드와 아웃바운드 규칙을 각각 정의해야 함.
	- 잘못된 규칙 구성 시 전체 서브넷의 트래픽 차단 가능.

### Default VPC
![[default_vpc.png]]

Default VPC는 AWS에서 자동으로 생성되는 기본 VPC 환경으로, 다음과 같은 특징을 가지고 있습니다:

- 각 AWS 리전마다 하나의 Default VPC가 생성됩니다.
- CIDR 범위는 **172.31.0.0/16**으로 설정됩니다.
- 가용 영역(AZ)마다 `/20` 크기의 서브넷이 기본적으로 생성됩니다.
- Default VPC는 이미 **인터넷 게이트웨이(Internet Gateway)**가 연결되어 있으며, 모든 서브넷이 기본적으로 퍼블릭 서브넷으로 설정되어 외부와 통신이 가능합니다.
- 사용자는 Default VPC를 수정하거나 삭제할 수 있으며, 삭제 후에는 콘솔을 통해 재생성할 수 있습니다.

#### **장점**

- AWS에서 기본적으로 제공하므로 별도의 설정 없이 VPC 환경을 빠르게 사용할 수 있음.
- 초보자와 테스트 환경에 적합.

#### **단점**

- 기본적으로 모든 서브넷이 퍼블릭 서브넷이므로 보안상의 위험이 있을 수 있음.
- 실제 프로덕션 환경에는 적합하지 않음.

### Nat Gateway

NAT Gateway는 Amazon VPC에서 사설 서브넷에 있는 리소스가 인터넷이나 다른 AWS 서비스에 안전하게 접근할 수 있도록 지원하는 관리형 네트워크 구성 요소입니다. NAT Gateway는 들어오는 트래픽을 차단하면서 아웃바운드 트래픽만 허용합니다.

#### **특징**

- **보안 강화**: 사설 서브넷의 리소스에 대해 들어오는 트래픽을 차단하고, 아웃바운드 인터넷 접근만 허용.
- **고가용성**: NAT Gateway는 기본적으로 AZ별로 고가용성을 제공하며, 장애 복구 없이 자동으로 동작.
- **확장성**: 고성능 네트워크 처리량(최대 45Gbps)을 지원하며, 트래픽 양에 따라 자동 확장.
- **간편성**: AWS에서 관리되며, 유지보수나 설정이 간단.

![[natgw_basic.png]]


#### Multi AZ 구성
NAT Gateway의 Multi-AZ 관련 주요 사항 - NAT Gateway는 특정 가용 영역(AZ)에 배포됩니다. - 고가용성을 위해 각 AZ에 NAT Gateway를 각각 생성해야 합니다. - 각 사설 서브넷은 동일한 AZ의 NAT Gateway와 연결되도록 라우팅 테이블을 구성해야 합니다. - NAT Gateway는 AZ 수준의 장애 복구를 보장하며, 한 AZ의 NAT Gateway가 중단되더라도 다른 AZ의 NAT Gateway에는 영향을 미치지 않습니다. - 다중 AZ를 구성하면 추가적인 비용이 발생하지만, 중요한 워크로드에서 높은 가용성을 보장합니다.

#### **장점**

- AWS 관리형 서비스로 구성 및 유지보수에 부담이 없음.
- 동시 연결 및 데이터 처리량에 제한이 적어 대규모 환경에 적합.
- IP 주소 자동 할당 및 관리 기능 제공.

#### **단점**

- NAT Gateway 사용에 따른 추가 비용 발생.
- 가용 영역별로 NAT Gateway를 구성해야 하므로 설정이 단순하지만 비용이 증가할 수 있음.

#### **특이점**

- NAT Gateway는 아웃바운드 트래픽만 처리하며, 들어오는 요청은 지원하지 않음.
- 가용 영역 단위로 배포되며, 다중 AZ 아키텍처에서는 각 AZ에 하나씩 생성하는 것이 권장됨.
- IPv6에서는 NAT Gateway를 사용할 수 없으며, 대체로 Egress-only Internet Gateway를 사용.

### Nat Instance (EC2 base NAT)
#### **요약**

NAT Instance는 Amazon EC2 인스턴스를 활용하여 VPC의 사설 서브넷에 위치한 리소스가 인터넷에 접근할 수 있도록 구성하는 방법입니다. NAT Gateway와 비교하여 더 많은 사용자 정의와 비용 효율성을 제공하지만, 수동 관리가 필요합니다.

![[natinstance_demo.png]]

#### **특징**

- **EC2 기반**: NAT 역할을 수행하기 위해 Amazon EC2 인스턴스를 사용.
- **트래픽 처리**: 사설 서브넷에서 인터넷으로 나가는 아웃바운드 트래픽만 허용.
- **보안 그룹**: EC2 보안 그룹을 설정하여 네트워크 트래픽을 제어 가능.
- **유지보수 필요**: 사용자가 직접 인스턴스 크기, 소프트웨어 업데이트 및 복구를 관리해야 함.

#### **장점**

- 비용 효율적: 작은 규모의 트래픽 처리에 적합.
- 사용자 정의 가능: 고급 네트워크 설정 및 사용자 지정 소프트웨어 설치 가능.
- 다양한 선택지: EC2 인스턴스 유형을 사용자가 선택 가능.

#### **단점**

- 관리 부담: 사용자가 직접 설정 및 유지보수를 관리해야 함.
- 고가용성 부족: EC2 인스턴스 장애 시 트래픽이 중단될 수 있음.
- 성능 제한: EC2 인스턴스의 크기에 따라 트래픽 처리량이 제한됨.

#### 비교
| **특징**				| **NAT Gateway**								  | **NAT Instance**							|
|--------------------------|--------------------------------------------------|---------------------------------------------|
| **관리 주체**			| AWS 관리형 서비스								 | 사용자가 EC2 인스턴스를 관리해야 함			|
| **성능**				| 자동 확장 (최대 45Gbps)							| EC2 인스턴스 크기에 따라 성능 제한			|
| **가용성**			  | AZ별 고가용성 지원								| 인스턴스 장애 시 사용자가 수동으로 복구 필요	|
| **설치 및 설정**		 | 간단한 설정만으로 사용 가능						 | EC2 인스턴스와 관련 리소스 수동 구성 필요	   |
| **비용**				| 데이터 처리량에 따라 비용 발생					  | EC2 인스턴스 유형에 따라 비용 결정			 |
| **IPv6 지원 여부**	   | 지원하지 않음 (IPv6는 Egress-only Gateway 사용)	  | 지원하지 않음								 |
| **보안 그룹**			| NAT Gateway에 직접 보안 그룹을 적용할 수 없음		| EC2 인스턴스에 보안 그룹을 적용 가능		  |
| **유지보수**			| AWS가 자동으로 유지보수							| 사용자가 직접 인스턴스를 관리 및 유지보수 필요  |
| **다중 AZ 구성**		 | 각 AZ에 개별 NAT Gateway를 생성해야 함			   | 다중 AZ 구성 시 여러 NAT 인스턴스를 수동 구성   |
| **사용 사례**		   | 고성능, 대규모 네트워크 트래픽 처리				  | 저비용, 소규모 또는 임시 네트워크 환경		  |

#### **AWS 관련 서비스**

- **인터넷 게이트웨이(IGW)**: 인터넷으로 트래픽 라우팅.
- **라우팅 테이블**: 사설 서브넷에서 NAT Instance로 트래픽을 라우팅하도록 설정 필요.

#### **특이점**

- EC2 인스턴스에 퍼블릭 IP 주소를 할당해야 함.
- 고가용성을 위해 다중 AZ 구성 시 별도의 NAT Instance를 추가 설정해야 함.
- IP 마스커레이딩(IP Masquerading)을 통해 사설 IP 주소를 공용 IP 주소로 변환.

### VPC Exam Essentials
#### **시험 준비를 위한 주요 내용**

1. **VPC의 기본 구성 요소**:
	- CIDR 블록의 범위와 서브넷 크기 계산.
	- 기본 VPC와 커스텀 VPC의 차이점.
2. **네트워크 주소 지정**:
	- IPv4와 IPv6의 차이점.
	- 사설 IP 주소와 공용 IP 주소의 역할.
3. **보안 구성**:
	- 보안 그룹(Security Group)의 상태 유지(stateful) 특징.
	- 네트워크 ACL(Network ACL)의 상태 비유지(stateless) 특징.
	- 두 보안 기능의 차이와 사용 사례.
4. **라우팅 및 게이트웨이**:
	- 라우팅 테이블 설정 및 NAT Gateway를 통한 인터넷 액세스 구성.
	- NAT Gateway와 NAT Instance의 차이점.
5. **고가용성 아키텍처 설계**:
	- NAT Gateway의 다중 AZ 구성 방법.
	- VPC에 고가용성을 추가하는 방법.
6. **기본 VPC 환경**:
	- Default VPC의 특성과 사용 사례.
	- Default VPC 삭제 및 복구 방법.

## 2. Additionnal VPC Feature

### Extending VPC Address Space
#### **주요 개념**

1. **CIDR 블록 추가**:
	- AWS에서는 VPC에 최대 5개의 추가 CIDR 블록을 할당할 수 있음.
	- IPv4 CIDR 블록은 `/16`에서 `/28`까지 지원.
	- 추가된 CIDR은 기존 CIDR과 중복되지 않아야 함.
2. **IPv6 지원**:
	- AWS에서 할당된 IPv6 CIDR 블록은 `/56`로 고정.
	- IPv6는 전역적으로 고유하며, 프라이빗 네트워크와 퍼블릭 네트워크 모두에서 사용 가능.
3. **사용 사례**:
	- 리소스 증가로 기존 서브넷의 IP 주소가 부족할 때 CIDR 확장 필요.
	- 새로운 워크로드를 지원하기 위해 추가 서브넷을 구성해야 할 경우.
4. **제약 조건**:
	- 추가된 CIDR 블록은 원래의 VPC CIDR과 동일한 RFC 1918 범위여야 함.
	- CIDR 블록 변경은 실시간 트래픽에 영향을 미치지 않음.

#### **장점**
- 기존 리소스를 중단하지 않고 VPC 주소 공간 확장 가능.
- 유연한 네트워크 설계를 통해 리소스 증가에 대응 가능.
- IPv6 CIDR 블록을 활용하여 향후 확장성 확보.

#### **단점**
- CIDR 충돌 방지 규칙을 수동으로 관리해야 함.
- 잘못된 CIDR 설계는 복잡성을 초래할 수 있음.

![[ans/image/add_vpc_cidr.png]]![[add_vpc_cidr 1.png]]

### ENI
![[add_vpc_eni.png]]
#### **요약**
Elastic Network Interface (ENI)는 Amazon VPC의 가상 네트워크 카드로, EC2 인스턴스에 네트워크 연결을 제공하는 중요한 구성 요소입니다. ENI는 네트워크 트래픽을 유연하게 관리하고 고가용성을 지원하기 위한 다양한 기능을 제공합니다.

---

#### **주요 개념**

1. **ENI의 정의 및 역할**:
	- ENI는 VPC 내부에서 IP 주소와 네트워크 연결을 관리하는 네트워크 어댑터.
	- 인스턴스와 분리 가능하며, 한 ENI를 다른 EC2 인스턴스에 연결할 수 있음.
2. **ENI의 주요 구성 요소**:
	- **기본 NIC**: EC2 인스턴스 생성 시 자동으로 생성되며 기본 NIC로 설정.
	- **보안 그룹**: ENI 수준에서 보안 그룹을 설정하여 트래픽 제어.
	- **Private IP 및 Elastic IP**: ENI는 하나 이상의 프라이빗 IP를 가질 수 있으며, EIP와 연결 가능.
3. **ENI의 활용 사례**:
	- **다중 네트워크 구성**: 단일 인스턴스에 여러 ENI를 추가하여 다중 네트워크 연결 구성.
	- **고가용성 및 장애 복구**: 장애 시 ENI를 다른 인스턴스로 연결하여 빠른 복구 지원.
	- **애플리케이션 분리**: 한 인스턴스에서 여러 네트워크 구성을 분리하여 운영.
4. **고급 사용 사례**:
	- **ENI Trunking**: 고밀도 워크로드에서 다중 ENI를 사용하여 IP 주소 확장.
	- **ENI의 이동성**: ENI를 하나의 인스턴스에서 다른 인스턴스로 이동 가능.

---

#### **장점**

- 네트워크 구성을 유연하게 변경할 수 있음.
- 다중 네트워크를 통해 분리된 트래픽을 처리 가능.
- ENI의 분리 및 이동성을 통해 장애 복구 및 유지보수에 용이.

#### **단점**

- ENI의 설정과 관리는 사용자가 직접 수행해야 하므로 복잡성이 증가할 수 있음.
- 네트워크 처리량은 EC2 인스턴스 유형에 따라 제한될 수 있음.

---

![[add_vpc_eni_max.png]]
![[add_vpc_eni_rds.png]]
![[add_vpc_eni_dual_home.png]]
![[add_vpc_eni_ha.png]]
![[add_vpc_eni_eks_pods.png]]

### Bring Your Own IP (BYOIP)
#### **요약**

**Bring Your Own IP (BYOIP)**는 고객이 소유한 IP 주소를 AWS로 가져와 AWS 서비스와 통합해 사용할 수 있게 해주는 기능입니다. 이 기능은 클라우드로의 전환 시 네트워크 변경을 최소화하고 고객이 기존 IP 주소를 유지할 수 있도록 돕습니다.

---

#### **주요 개념**

1. **BYOIP의 정의**:
	
	- 고객이 소유한 IPv4 또는 IPv6 주소를 AWS로 이전하여 Amazon VPC 및 AWS Global Accelerator와 같은 서비스에서 사용 가능.
	- IP 주소는 AWS 리전에 매핑되어 AWS 네트워크에서 활용.
2. **주요 사용 사례**:
	
	- 기존 IP 주소를 사용하는 고객들에게 클라우드 전환 간소화.
	- 기업이 자체 IP 주소를 유지하여 DNS 변경 없이 마이그레이션 가능.
	- 규제 요건 충족을 위해 특정 IP 주소 유지.
3. **프로세스**:
	
	- **검증**: 고객의 IP 주소 소유권을 AWS에 검증.
	- **광고**: AWS의 네트워크에서 IP 주소가 광고되도록 설정.
	- **사용**: AWS 서비스에서 IP 주소를 사용(예: Elastic Load Balancer, EC2).
4. **BYOIP의 주요 제약 조건**:
	
	- AWS가 고객의 IP 소유권을 확인하기 위한 검증 절차 필요.
	- IPv4는 AWS 리전에서 BYOIP를 지원하며, IPv6은 글로벌 네트워크에서 지원.
	- IP 주소가 AWS 외부에서 사용 중인 경우 일부 제한 가능.

---

#### **장점**

- 클라우드로 전환 시 기존 네트워크 설정을 유지 가능.
- IP 주소의 소유권과 유연성을 유지하며 AWS 리소스를 활용.
- 네트워크 구성의 변경이 최소화되어 다운타임 감소.

#### **단점**

- BYOIP 설정 및 소유권 검증에는 시간이 걸릴 수 있음.
- AWS 환경 외부에서 사용하는 IP와의 통합은 추가 작업이 필요할 수 있음.

## 3. VPC DNS and DHCP
### Amazon VPC DNS 옵션

#### 요약:
- **Amazon VPC의 기본 DNS 기능:**
    
    - Amazon VPC는 기본적으로 DNS 해석 및 호스트 이름 생성 기능을 제공합니다.
    - 퍼블릭 및 프라이빗 DNS 옵션을 활성화하여 클라우드 환경에서 네트워크 자원을 효과적으로 관리.
- **DNS 호스트 이름 및 DNS 해석기:**
    
    - VPC 내에서 EC2 인스턴스에 자동으로 DNS 호스트 이름을 할당.
    - 기본적으로 `ec2.internal` 형식의 이름을 제공하며, 퍼블릭 IP가 활성화된 경우 퍼블릭 DNS 이름도 제공.
- **DNS 해석 옵션:**
    
    - 퍼블릭 DNS 해석을 허용하거나, 프라이빗 DNS만 허용하는 설정 가능.
    - AWS에서는 Route 53 Resolver를 통해 외부 DNS 쿼리를 처리할 수 있음.

#### 장점:

- 사용자가 별도로 관리할 필요 없이 자동으로 DNS가 할당.
- 프라이빗 DNS를 활용해 보안이 강화된 네트워크 환경 제공.

#### 단점:

- 기본 DNS 옵션은 커스텀 도메인 요구 사항에 적합하지 않을 수 있음.
- 퍼블릭 DNS를 활성화하면 잠재적인 보안 문제가 발생할 가능성.

#### AWS에서 관련 서비스:

- **Route 53 Resolver:** VPC와의 통합을 통해 DNS 쿼리를 처리.
- **DHCP 옵션 세트:** VPC 내 DNS 서버 주소를 동적으로 구성.

#### 주의사항:

- 퍼블릭 DNS 이름을 활성화하려면 VPC와 서브넷의 인터넷 게이트웨이가 올바르게 구성되어 있어야 함.
- 프라이빗 DNS를 사용할 때는 자체 DNS 서버를 설정하거나 AWS 제공 DNS를 사용해야 함.
### DNS VPC DNS Server (Route 53 Resolver)
![[vpc_dns_base.png]]
### Route 53 Resolver와의 통합 (섹션 3, 주제 3)

#### 요약:

- **Route 53 Resolver란?**
    - Amazon Route 53 Resolver는 VPC 내에서 DNS 쿼리를 처리하고 온프레미스 네트워크와의 통합을 지원하는 DNS 해석기입니다.
    - VPC와 온프레미스 네트워크 간 DNS 쿼리를 원활히 전송할 수 있도록 인바운드 및 아웃바운드 엔드포인트를 제공.
- **주요 기능:**
    - **인바운드 엔드포인트:**
        - 온프레미스 DNS 서버에서 AWS VPC로 DNS 쿼리를 전달.
    - **아웃바운드 엔드포인트:**
        - VPC 내 DNS 쿼리를 온프레미스 DNS 서버로 전달.
- **활용 사례:**
    - 온프레미스 네트워크와 AWS 간의 하이브리드 네트워크에서 통합된 DNS 관리.
    - 여러 VPC와 연결된 복잡한 네트워크 아키텍처에서 DNS 쿼리를 중앙 관리.

#### 장점:
- 하이브리드 네트워크에서 DNS 쿼리를 쉽게 통합 가능.
- VPC와 온프레미스 네트워크 간 상호작용을 단순화.
- 기존 DNS 서버를 유지하면서 AWS 네트워크를 통합할 수 있음.

#### 단점:
- 엔드포인트 설정 및 운영에 대한 추가 비용 발생.
- 잘못된 설정으로 인해 DNS 쿼리 흐름에 문제가 발생할 수 있음.

#### AWS에서 관련 서비스:
- **Route 53 Resolver:** 기본 제공 DNS 해석 및 인바운드/아웃바운드 엔드포인트.
- **VPC Peering:** 연결된 VPC 간 DNS 쿼리 처리.
- **Transit Gateway:** 여러 VPC와 온프레미스 네트워크 간 트래픽 관리.

#### 주의사항:
- 인바운드와 아웃바운드 엔드포인트는 보안 그룹을 통해 접근을 제어해야 함.
- VPC와 온프레미스 간 IP 주소 충돌이 없는지 확인 필수.
- 온프레미스 네트워크와 VPC 간 경로 설정이 정확해야 함.

#### 시험에서 자주 등장하는 패턴:
1. 하이브리드 네트워크에서 DNS 엔드포인트 구성 문제.
2. DNS 쿼리를 인바운드 및 아웃바운드 엔드포인트로 라우팅하는 시나리오.
3. Route 53 Resolver의 동작 원리를 묻는 문제.

### ### DHCP 옵션 세트

#### 요약:

- **DHCP 옵션 세트란?**
    - DHCP 옵션 세트를 통해 Amazon VPC에서 동적으로 IP 주소 및 네트워크 설정을 제공합니다.
    - 기본적으로 각 VPC는 하나의 DHCP 옵션 세트와 연결되며, 여러 네트워크 매개변수(예: DNS 서버, 도메인 이름 등)를 정의할 수 있음.
- **구성 가능한 옵션:**
    1. **Domain Name Servers (DNS):**
        - 네트워크의 기본 및 보조 DNS 서버를 지정.
    2. **Domain Name:**
        - 네트워크의 기본 도메인 이름을 설정.
    3. **NTP Servers:**
        - 네트워크 시간 동기화를 위한 NTP 서버 주소를 정의.
    4. **NetBIOS 옵션:**
        - Windows 기반 네트워크를 위한 NetBIOS 서버 및 관련 옵션을 설정.
- **활용 사례:**
    - VPC에서 커스텀 DNS 서버 사용.
    - 특정 NTP 서버로 시간 동기화.
    - 다양한 환경에 맞게 네트워크 매개변수를 동적으로 설정.

#### 장점:
- VPC 내 인스턴스가 네트워크 설정을 자동으로 수신.
- 다양한 네트워크 환경에서 쉽게 설정 변경 가능.
- 네트워크 관리 자동화로 설정 오류 최소화.

#### 단점:
- 모든 매개변수가 모든 네트워크 환경에 적용되지는 않음.
- 잘못된 옵션 설정 시 네트워크 접속 문제 발생 가능.

#### AWS에서 관련 서비스:
- **Amazon Route 53:** 커스텀 DNS 서버 설정 시 활용.
- **VPC Subnet:** 서브넷별로 DHCP 옵션 세트를 관리.

#### 주의사항:
- 기본 DHCP 옵션 세트는 삭제할 수 없으며, 필요한 경우 새 옵션 세트를 생성하여 대체.
- DHCP 옵션 세트는 VPC 단위로만 적용 가능(서브넷 단위는 불가).
- 커스텀 DNS 서버를 지정할 경우, 해당 서버가 가용한 상태인지 확인 필요.

#### 시험에서 자주 등장하는 패턴:
1. DHCP 옵션 세트를 사용하여 VPC 내 네트워크 설정 변경 문제.
2. 커스텀 DNS 서버를 사용한 구성 시나리오.
3. DHCP 옵션 세트와 기본 VPC 네트워크 매개변수의 관계를 묻는 질문.